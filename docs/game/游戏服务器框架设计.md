# 游戏服务器框架设计

## 游戏分层设计

一般的游戏架构分为三层：系统层、引擎层、逻辑层。

**系统层：**

系统层是基于操作系统的API开发，需要一些操作系统的知识，比如Linux底层的API，进程线程以及多线程的通信和同步问题；

**引擎层：**

引擎层是那些与逻辑内容关联性不大，但是需要系统的层的支持，一些抽取出来的独立的功能，这些功能为逻辑层提供开发便利；

常见的引擎问题分为：物理引擎、通信、日志、数据库读写、场景管理、配置管理、主循环、脚本系统、计时器、内存管理、线程管理、容错机制、基础游戏对象、视野管理。

**逻辑层：**

逻辑层就是具体的游戏玩法，系统功能，逻辑层一般包括：具体游戏对象(玩家、NPC、怪物)、任务、聊天、交友、战斗、帮会、道具、技能、副本、宠物、PK；



## 服务端架构设计

一般采取多线程设计，主的逻辑是一个线程，一个`DB`线程、网络线程、log线程、Engine线程。这些负责不同的逻辑功能，然后在主线程里不断轮询。线程里一般是用一个消息队列维护不同线程的消息。

```c++
int main(int argc, char* argv[])
{
   Init(); //初始化各种资源、环境、数据
    while(g_State != GAME_EXIT)
   {
       CheckToSleep(); // 定一个循环间隔，没跑满的时间咱们让CPU放松下
        //GameLoop
       NetMessLoop();  // 收发网络消息，并将收到的消息分派给各个模块（比如加到各自的消息队列中）
        NpcAILoop();    // Npc的AI
       PlayerLoop();   // 处理玩家行为
        //OtherLoop     // 比如帮会、副本、任务等等等
        DBLoop();       // 数据库操作
        TimeEvent();    // 定时任务
    }
    Release(); // 清理和记录工作
    return 0;
}
```





## References

[游戏开发笔记](https://blog.csdn.net/mooke/article/details/8868613)

[服务端架构设计](https://blog.csdn.net/mooke/article/details/8913051)

