# 手游登录流程

## 登录渠道(客户端)

流程：

1. 客户端输入渠道账号`user_name`和密码`password`；
2.  登录，登录SDK成功之后，会返回一个`token`；
3.  保存token；

传入： `app_id`、`app_key`、`user_name`、`password`
返回： `token`

说明：
`app_id`和`app_key`是游戏制作方在接入渠道sdk时申请的；
`user_name`和`password`需要游戏玩家自己申请，有的渠道支持游客登录。

## 获取服务器列表(客户端)

流程

1. 登录成功之后可以获取服务器列表server_list；
2.  显示服务器列表；

返回： *server_list*

说明：
游戏服务器列表一般是通过配置在客户端的一个链接直接获取的；
这个配置文件可以通过资源更新的方式更新。

## 连接登录服(客户端)

1. 客户端选择连接服务器；
2. 通过选择的服务器可以得到登录服的`ip`和`port`；
3. 登录获取游戏服的`ip`和`port`；

传入：`token`

返回：`ip`、 `port`

说明：
在登录成功之后会返回游戏服的`ip`和`port`。

## 验证token(服务端)

1. 登录服拿到客户端传入的`token`；
2. 将`token`传入认证服务器，认证服去渠道验证；
3. 渠道验证成功之后会返回`UID`，然后保存认证信息(登录服务器的时候会用到);
4. 根据负载均衡分配游戏服`ip`和`port`, 返回给客户端；

传入: `app_id`、`app_key`、`token`

渠道返回: `UID`

返回给客户端:`ip`、`port`、`UID`

说明：

渠道验证一般是一个链接，在渠道的开发文档中会给出；

如果客户端用的游客账号登录，当游客绑定账号之后的`UID`也不会改变，除非是更换了设备，或者是卸载了游戏重新安装；

保存认证信息是为了防止玩家在没有通过认证的情况下直接登录游戏服务器；

大型手游后端会有多台游戏服务器，登录服会等根据负载均衡分配一台游戏服给玩家。

## 链接游戏服(客户端)

1. 拿到登录服返回的`ip` 和`port` 及`UID`之后断开登录服的链接；
2. 拿到新的`ip`和`port` 登录游戏服；

传入: `UID`

## 游戏服(服务端)

1. 拿到`UID`之后到认证服务器中验证玩家是否登录;
2. 认证成功之后返回该玩家服务器上的角色信息;
3. 进行游戏；

返回：角色信息



## References

[大型手游登录流程详解](https://blog.csdn.net/xufeng0991/article/details/48138625)

